<!--
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teaching Plan - Weekly Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8f8f8;
    }
    h1,
    h2 {
      text-align: center;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 900px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input,
    textarea,
    select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .week-buttons {
      text-align: center;
      margin: 20px 0;
    }
    .week-buttons button {
      margin: 3px;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      background-color: #eee;
      cursor: pointer;
    }
    .week-buttons button.active {
      background-color: #007BFF;
      color: white;
      font-weight: bold;
    }
    .week-form {
      margin-top: 20px;
      background-color: #f0f8ff;
      padding: 15px;
      border-radius: 8px;
    }
    #generateBtn,
    #exportWordBtn,
    #exportPdfBtn {
      display: block;
      margin: 10px auto;
      background-color: #007BFF;
      color: white;
      padding: 12px 30px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@8.4.0/build/index.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.7.0/docx.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.3/dist/purify.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <h1>TEMASEK POLYTECHNIC</h1>
  <h2>SCHOOL OF INFORMATICS & IT</h2>
  <form id="teachingPlanForm" onsubmit="return false;">
    <label for="diploma">Diploma In:</label>
    <input type="text" id="diploma" name="diploma" required>
    <label for="course">Teaching Plan For:</label>
    <input type="text" id="course" name="course" required>
    <label for="startDate">Semester Start Date:</label>
    <input type="date" id="startDate" name="startDate" required>
    <button type="button" onclick="initializeWeeks()">Start Plan</button>
    <div id="weekTabs" class="week-buttons"></div>
    <div id="weekForm" class="week-form" style="display:none;">
      <h3 id="weekTitle">Week X</h3>
      <label>Week Type:</label>
      <select id="weekType" onchange="handleWeekTypeChange()">
        <option value="normal" selected>Normal Week</option>
        <option value="term_test">Term Test</option>
        <option value="term_break">Term Break</option>
        <option value="flex_week">Flex Week</option>
        <option value="study_week">Study Week</option>
      </select>
      <label>Session #1:</label>
      <input type="text" id="session1">
      <label>Session #2:</label>
      <input type="text" id="session2">
      <label>E-Learning / Independent Learning:</label>
      <input type="text" id="elearning">
      <label>ILO - Contact Hours:</label>
      <input type="text" id="ilo_contact">
      <label>ILO - Non-Contact Hours:</label>
      <input type="text" id="ilo_noncontact">
      <label>Remarks:</label>
      <textarea id="remarks" rows="3"></textarea>
    </div>
    <div id="specialPeriods" style="margin-top: 30px; background: #fff3cd; padding: 15px; border-radius: 8px;">
      <h3>Special Periods</h3>
      <label for="examStart">Examination Period Start:</label>
      <input type="date" id="examStart">
      <label for="examEnd">Examination Period End:</label>
      <input type="date" id="examEnd">
      <label for="vacationStart">Vacation Period Start:</label>
      <input type="date" id="vacationStart">
      <label for="vacationEnd">Vacation Period End:</label>
      <input type="date" id="vacationEnd">
    </div>
  </form>
  <button id="generateBtn">Generate Teaching Plan</button>
  <button id="exportWordBtn">Export to Word</button>
  <button id="exportPdfBtn">Export to PDF</button>
  <script>
    const weeksData = [{
      weekType: 'normal', session1: '', session2: '', elearning: '', ilo_contact: '', ilo_noncontact: '', remarks: ''
    }];
    let currentWeekIndex = null;
    function initializeWeeks() {
      renderWeekTabs();
      document.getElementById('weekForm').style.display = 'block';
      loadWeek(0);
    }
    function renderWeekTabs() {
      const tabs = document.getElementById('weekTabs');
      tabs.innerHTML = '';
      weeksData.forEach((_, i) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.innerText = `Week ${i + 1}`;
        btn.onclick = () => loadWeek(i);
        btn.id = `weekBtn${i}`;
        tabs.appendChild(btn);
      });
      const addBtn = document.createElement('button');
      addBtn.type = 'button';
      addBtn.innerText = '+ Add Week';
      addBtn.onclick = addWeek;
      addBtn.style.marginLeft = '10px';
      tabs.appendChild(addBtn);
    }
    function addWeek() {
      saveWeekData();
      weeksData.push({
        weekType: 'normal', session1: '', session2: '', elearning: '', ilo_contact: '', ilo_noncontact: '', remarks: ''
      });
      renderWeekTabs();
      loadWeek(weeksData.length - 1);
    }
    function loadWeek(index) {
      if (currentWeekIndex !== null) saveWeekData();
      currentWeekIndex = index;
      document.getElementById('weekTitle').innerText = `Week ${index + 1}`;
      for (let i = 0; i < weeksData.length; i++) {
        const btn = document.getElementById(`weekBtn${i}`);
        if (btn) btn.classList.remove('active');
      }
      const activeBtn = document.getElementById(`weekBtn${index}`);
      if (activeBtn) activeBtn.classList.add('active');
      const data = weeksData[index];
      document.getElementById('weekType').value = data.weekType || 'normal';
      document.getElementById('session1').value = data.session1;
      document.getElementById('session2').value = data.session2;
      document.getElementById('elearning').value = data.elearning;
      document.getElementById('ilo_contact').value = data.ilo_contact;
      document.getElementById('ilo_noncontact').value = data.ilo_noncontact;
      document.getElementById('remarks').value = data.remarks;
      handleWeekTypeChange();
    }
    function handleWeekTypeChange() {
      const type = document.getElementById('weekType').value;
      const isDisabled = type !== 'normal';
      const fields = ['session1', 'session2', 'elearning', 'ilo_contact', 'ilo_noncontact', 'remarks'];
      fields.forEach(id => {
        const field = document.getElementById(id);
        field.disabled = isDisabled;
        field.style.backgroundColor = isDisabled ? '#eee' : '';
      });
    }
    function saveWeekData() {
      if (currentWeekIndex === null) return;
      const weekType = document.getElementById('weekType').value;
      const session1 = document.getElementById('session1').value.trim();
      const session2 = document.getElementById('session2').value.trim();
      const elearning = document.getElementById('elearning').value.trim();
      const ilo_contact = document.getElementById('ilo_contact').value.trim();
      const ilo_noncontact = document.getElementById('ilo_noncontact').value.trim();
      const remarks = document.getElementById('remarks').value.trim();
      weeksData[currentWeekIndex] = {
        weekType: weekType,
        session1: session1,
        session2: session2,
        elearning: elearning,
        ilo_contact: ilo_contact,
        ilo_noncontact: ilo_noncontact,
        remarks: remarks
      };
    }


    document.getElementById('generateBtn').addEventListener('click', generateTeachingPlanTable);
    function generateTeachingPlanTable() {
      saveWeekData();
      const tableWindow = window.open('', '_blank');
      const doc = tableWindow.document;
      let tableHTML = `
        <title>Generated Teaching Plan</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          table { border-collapse: collapse; width: 100%; }
          th, td { border: 1px solid #666; padding: 6px; text-align: center; vertical-align: middle; }
          th { background-color: #cce5ff; }
          .grey { background-color: #d9d9d9; }
          .center-text { text-align: center; }
        </style>
        </head><body>
        <div class="center-text">
          <h2>TEMASEK POLYTECHNIC<br>SCHOOL OF INFORMATICS & IT</h2>
          <h3>Generated Teaching Plan</h3>
        </div>
        <table>
          <tr class="grey">
            <th>Wk</th>
            <th>Commencing</th>
            <th colspan="2">Contact Hours<br>Workshop / Practical / Tutorial</th>
            <th>Non-Contact Hours<br>E-Learning / Independent Learning</th>
            <th>ILO<br>Contact Hours</th>
            <th>ILO<br>Non-Contact Hours</th>
            <th>Remarks</th>
          </tr>
      `;
      const startDate = new Date(document.getElementById('startDate').value);
      for (let i = 0; i < weeksData.length; i++) {
        const data = weeksData[i];
        const weekNo = i + 1;
        const isEmpty = !data.weekType || (
          data.weekType === 'normal' &&
          !data.session1 && !data.session2 && !data.elearning &&
          !data.ilo_contact && !data.ilo_noncontact && !data.remarks
        );
        if (isEmpty) continue;
        const weekStart = new Date(startDate);
        weekStart.setDate(weekStart.getDate() + i * 7);
        const formatDate = (date) => {
          const options = { day: '2-digit', month: 'short', year: '2-digit' };
          return date.toLocaleDateString('en-GB', options);
        };
        let row = `<tr><td>${weekNo}</td><td>${formatDate(weekStart)}</td>`;
        if (data.weekType === 'normal') {
          row += `
            <td>${data.session1 || ''}</td>
            <td>${data.session2 || ''}</td>
            <td>${data.elearning || ''}</td>
            <td>${data.ilo_contact || ''}</td>
            <td>${data.ilo_noncontact || ''}</td>
            <td>${data.remarks || ''}</td>
          `;
        } else {
          // For flex week or term break (special week types)
          const span = `<td colspan="6" style="text-align:center; vertical-align:middle; border-right: 1px solid #666;">
                          <strong>${data.weekType.replace('_', ' ').toUpperCase()}</strong>
                        </td>`;
          row += span + '</tr>';
          tableHTML += row;
          continue;
        }
        row += `</tr>`;
        tableHTML += row;
      }
      function formatRange(startStr, endStr) {
        if (!startStr || !endStr) return '';
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        const start = new Date(startStr).toLocaleDateString('en-GB', options);
        const end = new Date(endStr).toLocaleDateString('en-GB', options);
        return `${start} – ${end}`;
      }
      const examRange = formatRange(document.getElementById('examStart').value, document.getElementById('examEnd').value);
      if (examRange) {
        tableHTML += `
          <tr>
            <td colspan="8" style="text-align:center; vertical-align:middle; font-weight:bold;">EXAMINATION ${examRange}</td>
          </tr>
        `;
      }
      const vacationRange = formatRange(document.getElementById('vacationStart').value, document.getElementById('vacationEnd').value);
      if (vacationRange) {
        tableHTML += `
          <tr>
            <td colspan="8" style="text-align:center; vertical-align:middle; font-weight:bold;">VACATION ${vacationRange}</td>
          </tr>
        `;
      }
      tableHTML += `</table></body></html>`;
      doc.open();
      doc.write(tableHTML);
      doc.close();
    }

    document.getElementById('exportPdfBtn').addEventListener('click', exportTeachingPlanToPDF);
    function exportTeachingPlanToPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  // Create a hidden container
  const tempContainer = document.createElement("div");
  tempContainer.style.position = "absolute";
  tempContainer.style.left = "-9999px";
  document.body.appendChild(tempContainer);
  // Build the HTML content
  let tableHTML = `
    <div id="pdf-content">
      <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #666; padding: 6px; text-align: center; vertical-align: middle; }
        th { background-color: #cce5ff; }
        .grey { background-color: #d9d9d9; }
        .center-text { text-align: center; }
      </style>
      <div class="center-text">
        <h2>TEMASEK POLYTECHNIC<br>SCHOOL OF INFORMATICS & IT</h2>
        <h3>Generated Teaching Plan</h3>
      </div>
      <table>
        <tr class="grey">
          <th>Wk</th>
          <th>Commencing</th>
          <th colspan="2">Contact Hours<br>Workshop / Practical / Tutorial</th>
          <th>Non-Contact Hours<br>E-Learning / Independent Learning</th>
          <th>ILO<br>Contact Hours</th>
          <th>ILO<br>Non-Contact Hours</th>
          <th>Remarks</th>
        </tr>
  `;
  tableHTML += `</table></div>`;

  const startDate = new Date(document.getElementById('startDate').value);
  for (let i = 0; i < 18; i++) {
    const data = weeksData[i] || {}; // Default to empty object if undefined
    const weekNo = i + 1;
    const weekStart = new Date(startDate);
    weekStart.setDate(weekStart.getDate() + i * 7);
    const formatDate = (date) => {
      const options = { day: '2-digit', month: 'short', year: '2-digit' };
      return date.toLocaleDateString('en-GB', options);
    };
    let row = `<tr><td>${weekNo}</td><td>${formatDate(weekStart)}</td>`;
    if (data.weekType === 'normal') {
      row += `
        <td>${data.session1 || ''}</td>
        <td>${data.elearning || ''}</td>
        <td>${data.ilo_contact || ''}</td>
        <td>${data.ilo_noncontact || ''}</td>
        <td>${data.remarks || ''}</td>`;
    } else {
      const label = (data.weekType || 'N/A').replace('_', ' ').toUpperCase();
      const span = `<td colspan="6" style="text-align:center; vertical-align:middle;"><strong>${label}</strong></td>`;
      row += `${span}<td>${data.remarks || ''}</td>`;
    }
    row += `</tr>`;
    tableHTML += row;
  }
  const formatRange = (startStr, endStr) => {
    if (!startStr || !endStr) return '';
    return `${new Date(startStr).toLocaleDateString('en-GB')} to ${new Date(endStr).toLocaleDateString('en-GB')}`;
  };
  const examRange = formatRange(document.getElementById('examStart').value, document.getElementById('examEnd').value);
  if (examRange) {
    tableHTML += `
      <tr>
        <td colspan="7" style="text-align:center; vertical-align:middle;"><strong>EXAMINATION</strong> ${examRange}</td>
        <td></td>
      </tr>`;
  }
  const vacationRange = formatRange(document.getElementById('vacationStart').value, document.getElementById('vacationEnd').value);
  if (vacationRange) {
    tableHTML += `
      <tr>
        <td colspan="7" style="text-align:center; vertical-align:middle;"><strong>VACATION</strong> ${vacationRange}</td>
        <td></td>
      </tr>`;
  }
  tableHTML += `</table>`;
  // Inject into the container
  tempContainer.innerHTML = tableHTML;
  // Render to PDF
  doc.html(tempContainer, {
    callback: function (doc) {
      doc.save('Teaching_Plan.pdf');
      document.body.removeChild(tempContainer); // Clean up
    },
    margin: [20, 20, 20, 20],
    html2canvas: { scale: 2 },
  });
}
console.log(window.html2canvas); // should NOT be undefined
  </script>
  <script>
    document.getElementById('exportWordBtn').addEventListener('click', async () => {
  saveWeekData(); // Ensure data is saved before export
  const {
    Document, Packer, Paragraph, Table, TableRow, TableCell,
    WidthType, TextRun, AlignmentType, ShadingType
  } = window.docx;
  const formatDate = (dateStr) => {
    const date = new Date(dateStr);
    return dateStr ? date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: '2-digit' }) : '';
  };
  const formatRange = (startStr, endStr) => {
    if (!startStr || !endStr) return '';
    return `${new Date(startStr).toLocaleDateString('en-GB')} to ${new Date(endStr).toLocaleDateString('en-GB')}`;
  };
  const startDate = new Date(document.getElementById('startDate').value);
  const examRange = formatRange(document.getElementById('examStart').value, document.getElementById('examEnd').value);
  const vacationRange = formatRange(document.getElementById('vacationStart').value, document.getElementById('vacationEnd').value);
  const headerCells = [
    "Wk", "Commencing", "Contact Hours\nWorkshop / Practical", "Contact Hours\nTutorial",
    "Non-Contact Hours\nE-Learning", "ILO\nContact Hours", "ILO\nNon-Contact Hours", "Remarks"
  ];
  const tableRows = [
    new TableRow({
      children: headerCells.map((text, idx) => new TableCell({
        children: [
          new Paragraph({
            alignment: AlignmentType.CENTER,
            children: [new TextRun({ text, bold: true })]
          })
        ],
        width: { size: [10, 20, 20, 20, 20, 10, 10, 10][idx], type: WidthType.PERCENTAGE },
        shading: { fill: "CCE5FF", type: ShadingType.CLEAR }
      }))
    })
  ];
  for (let i = 0; i < weeksData.length; i++) {
    const week = weeksData[i];
    const hasContent =
      (week.session1 && week.session1.trim() !== '') ||
      (week.session2 && week.session2.trim() !== '') ||
      (week.elearning && week.elearning.trim() !== '') ||
      (week.ilo_contact && week.ilo_contact.trim() !== '') ||
      (week.ilo_noncontact && week.ilo_noncontact.trim() !== '') ||
      (week.remarks && week.remarks.trim() !== '') ||
      ["flex_week", "study_week", "term_break"].includes(week.weekType);
    if (!hasContent) continue;
    const weekStart = new Date(startDate);
    weekStart.setDate(weekStart.getDate() + i * 7);
    let row;
    if (["flex_week", "study_week", "term_break"].includes(week.weekType)) {
      // Special week row with merged cells
      row = new TableRow({
        children: [
          new TableCell({
            children: [new Paragraph({ text: (i + 1).toString(), alignment: AlignmentType.CENTER })],
            width: { size: 10, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: formatDate(weekStart), alignment: AlignmentType.CENTER })],
            width: { size: 20, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({
              text: week.weekType.replace("_", " ").toUpperCase(),
              alignment: AlignmentType.CENTER
            })],
            columnSpan: 6,
            width: { size: 70, type: WidthType.PERCENTAGE },
            shading: { fill: "d9d9d9", type: ShadingType.CLEAR }
          })
        ]
      });
    } else {
      // Regular teaching week
      row = new TableRow({
        children: [
          new TableCell({
            children: [new Paragraph({ text: (i + 1).toString(), alignment: AlignmentType.CENTER })],
            width: { size: 10, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: formatDate(weekStart), alignment: AlignmentType.CENTER })],
            width: { size: 20, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: week.session1 || '', alignment: AlignmentType.CENTER })],
            width: { size: 20, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: week.session2 || '', alignment: AlignmentType.CENTER })],
            width: { size: 20, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: week.elearning || '', alignment: AlignmentType.CENTER })],
            width: { size: 20, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: week.ilo_contact || '', alignment: AlignmentType.CENTER })],
            width: { size: 10, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: week.ilo_noncontact || '', alignment: AlignmentType.CENTER })],
            width: { size: 10, type: WidthType.PERCENTAGE }
          }),
          new TableCell({
            children: [new Paragraph({ text: week.remarks || '', alignment: AlignmentType.CENTER })],
            width: { size: 10, type: WidthType.PERCENTAGE }
          })
        ]
      });
    }
    tableRows.push(row);
  }
  if (examRange) {
    tableRows.push(new TableRow({
      children: [
        new TableCell({
          children: [new Paragraph({ text: `EXAMINATION ${examRange}`, alignment: AlignmentType.CENTER })],
          columnSpan: 8,
          width: { size: 100, type: WidthType.PERCENTAGE }
        })
      ]
    }));
  }
  if (vacationRange) {
    tableRows.push(new TableRow({
      children: [
        new TableCell({
          children: [new Paragraph({ text: `VACATION ${vacationRange}`, alignment: AlignmentType.CENTER })],
          columnSpan: 8,
          width: { size: 100, type: WidthType.PERCENTAGE }
        })
      ]
    }));
  }
  const doc = new Document({
    sections: [{
      properties: {},
      children: [
        new Paragraph({
          alignment: AlignmentType.CENTER,
          children: [
            new TextRun({
              text: "TEMASEK POLYTECHNIC",
              bold: true,
              size: 28,
              color: "000000"
            })
          ]
        }),
        new Paragraph({
          alignment: AlignmentType.CENTER,
          children: [
            new TextRun({
              text: "SCHOOL OF INFORMATICS & IT",
              bold: true,
              size: 26,
              color: "000000"
            })
          ]
        }),
        new Paragraph({
          alignment: AlignmentType.CENTER,
          children: [
            new TextRun({
              text: "Generated Teaching Plan",
              bold: true,
              size: 24,
              color: "000000"
            })
          ]
        }),
        new Table({ rows: tableRows })
      ]
    }]
  });
  const blob = await Packer.toBlob(doc);
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = "Teaching_Plan.docx";
  a.click();
  URL.revokeObjectURL(url);
});
    </script>
</body>
</html>
-->
